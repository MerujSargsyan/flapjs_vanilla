# Welcome to [`flap.js`](https://flapjs.github.io/vanilla/)
This is a vanilla js rewrite of the [`flap.js`](https://github.com/flapjs/webapp) project. Alternatively, you can consider this a minimal [JFLAP](https://www.jflap.org/) clone in javscript so people only need their browser.

# Repo Setup
1. clone this repo
2. get [Node](https://nodejs.org/en/download/) if you don't have it
3. `cd` into the cloned repo and run `npm install --save-dev`

# Technical Overview

## Machine Representation
To keep things simple, a finite automaton is represented by an adjacency list, and this is the single source of truth. The adjacency list is implemented as a dictionary, with each vertex not only having its neighbors but also some additional information. Here is an example
```
const vertex = {
  x: 640,
  y: 360,
  r: 24,
  is_start: true,
  is_final: false,
  out: [edge1, edge2, ...],
};
```
For each edge, if the edge is not a self loop, then this data scheme is employed
```
const edge = { transition: 'ε', from: 'q1', to: 'q0', a1: 0.4, a2: 0.3 };
```
Otherwise, the edge is a self loop, and we store two other vectors to make the drawing work
```
const edge = { transition: 'ε', from: 'q0', to: 'q0', a1: 0.5, a2: 1.0, angle1: Math.pi/2, angle2: Math.pi };
```
More detail regarding `a1`, `a2`, `angle1`, `angle2` will be discussed below.

## Drawing
There is no front end frameworks involved. For drawing the nodes, the `canvas` element from `html5` is used. As the name suggests, when drawing on a `canvas`, we are manipulating individual pixels on the screen. Therefore, most graphical operations require a complete redraw of the screen.

The drawing of edges uses the quadratic bezier curve provided by `canvas`. We specify the control point relative to where the vertices are placed so that the edges move with the vertices. In the diagram below, the red dot is the start, green dot is the control and the blue dot is the end. Moreover, the control point is stored in terms of the basis `v1` and `v2` so we get to write the control in terms of where the vertices are placed. The linear combination `a1*v1 + a2*v2` gives the coordinate of the control in terms of the standard basis (sans a translation constant).

![edge_mechanics](edge_mechanics.png)

Now, you may wonder what is the additional `angle1` and `angle2` when we have a self loop. These two angles are where the mouse left the vertex and where it came back in the vertex. We use these two angles to determine the starting and ending point of the self loop.

## Running Input
The simple package currently only has support for NFA (and by extention DFA). We simply do a BFS to see if we can reach a state whose `is_final` attribute is true.

# [Documentation](https://flapjs.github.io/vanilla/docs)
Documentation of the repo is auto generated by `JsDoc`. Currently, it is set to be run manually `npm run doc`.
